<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Megatron XS — System PW 계산기</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;padding:20px;max-width:720px;margin:0 auto}
    h1{font-size:20px}
    label{display:block;margin-top:12px}
    input[type=date]{padding:8px;font-size:16px}
    button{margin-top:12px;padding:10px 14px;font-size:15px}
    .card{border:1px solid #ddd;padding:14px;border-radius:8px;margin-top:12px;background:#fbfbfb}
    .mono{font-family:SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace}
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <h1>Megatron XS — "오늘의 System PW" 계산기</h1>
  <p class="muted">스크린샷 규칙: <span class="mono">System PW: DDYY × (Sunday=1) = xxxx</span> 방식으로 계산합니다.</p>

  <label for="d">날짜 선택</label>
  <input id="d" type="date">
  <div>
    <button id="calc">계산</button>
    <button id="copy">복사</button>
  </div>

  <div class="card">
    <div><strong>입력(DDYY)</strong>: <span id="ddyy" class="mono">-</span></div>
    <div><strong>요일 인덱스 (Sunday=1)</strong>: <span id="windex" class="mono">-</span></div>
    <div><strong>곱셈 결과 (DDYY × index)</strong>: <span id="prod" class="mono">-</span></div>
    <hr>
    <div><strong>최종 System PW (4자리)</strong>: <span id="pw" style="font-size:22px" class="mono">-</span></div>
  </div>

  <p class="muted">사용방법: 날짜를 고르고 '계산'을 누르면 DDYY를 만들고, 요일 인덱스(일요일=1)를 곱한 뒤 오른쪽 4자리(모듈 10000)를 출력합니다. 결과는 앞자리가 0이면 0으로 채워 4자리로 표시합니다.</p>

  <script>
    // 유틸
    function pad(n, len){return String(n).padStart(len,'0')}
    function toLocalDateInputValue(d){ // yyyy-mm-dd
      const tzOffset = d.getTimezoneOffset()*60000
      const localISO = new Date(d - tzOffset).toISOString().slice(0,10)
      return localISO
    }

    // 초기값: 오늘
    const dateInput = document.getElementById('d')
    dateInput.value = toLocalDateInputValue(new Date())

    const ddyyEl = document.getElementById('ddyy')
    const windexEl = document.getElementById('windex')
    const prodEl = document.getElementById('prod')
    const pwEl = document.getElementById('pw')
    const calcBtn = document.getElementById('calc')
    const copyBtn = document.getElementById('copy')

    function computeFor(dateStr){
      if(!dateStr) return null
      const parts = dateStr.split('-') // yyyy-mm-dd
      const yyyy = parseInt(parts[0],10)
      const mm = parseInt(parts[1],10)-1
      const dd = parseInt(parts[2],10)
      const dt = new Date(yyyy, mm, dd)

      const DD = pad(dd,2)
      const YY = pad(yyyy % 100,2)
      const DDYY = parseInt(DD + YY,10)

      // JS getDay(): 0=Sunday,1=Monday,...6=Saturday
      const jsDay = dt.getDay()
      const windex = (jsDay === 0) ? 1 : (jsDay + 1) // Sunday=1, Monday=2, ... Saturday=7

      const product = DDYY * windex
      const pwNum = product % 10000
      const pwStr = pad(pwNum,4)

      return {DD, YY, DDYY, windex, product, pwStr}
    }

    function render(dateStr){
      const r = computeFor(dateStr)
      if(!r){ ddyyEl.textContent='-';windexEl.textContent='-';prodEl.textContent='-';pwEl.textContent='-'; return }
      ddyyEl.textContent = String(r.DDYY)
      windexEl.textContent = String(r.windex)
      prodEl.textContent = String(r.product)
      pwEl.textContent = r.pwStr
    }

    calcBtn.addEventListener('click', ()=> render(dateInput.value))

    copyBtn.addEventListener('click', ()=>{
      const txt = pwEl.textContent || ''
      if(!txt || txt === '-') return alert('복사할 비밀번호가 없습니다. 먼저 계산하세요.')
      navigator.clipboard?.writeText(txt).then(()=>{
        alert('비밀번호가 클립보드에 복사되었습니다: ' + txt)
      }).catch(()=>{
        // fallback
        const ta = document.createElement('textarea')
        ta.value = txt
        document.body.appendChild(ta)
        ta.select()
        try{ document.execCommand('copy'); alert('복사됨: ' + txt) }catch(e){ alert('복사 실패 — 수동으로 복사하세요: ' + txt) }
        ta.remove()
      })
    })

    // 자동 계산(페이지 로드시)
    render(dateInput.value)
  </script>
</body>
</html>
